# タイプライター効果のドキュメント

このドキュメントでは、アプリケーションにおけるタイプライター効果の実装について説明します。

## コードの場所

タイプライター効果は `AnimationManager` クラスに実装されており、このクラスは `js/animation.js` ファイルにあります。

## `AnimationManager` クラス

`AnimationManager` クラスは、タイプライター効果やアバターの口のアニメーションなど、アニメーションの管理を担当します。

### コンストラクタ

```javascript
constructor(settings, soundManager) {
    this.settings = settings;
    this.soundManager = soundManager;
    this.talkingInterval = null;
    this.avatarImg = document.getElementById('avatar-img');
    this.output = document.getElementById('output');
}
```

コンストラクタは、設定とサウンドマネージャで `AnimationManager` を初期化します。また、DOMからアバターの画像と出力要素への参照を取得します。

## `typeWriter` 関数

`typeWriter` 関数は、テキストをタイプライター効果で表示する役割を担います。

```javascript
typeWriter(element, text) {
    return new Promise((resolve) => {
        let i = 0;
        
        // 口のアニメーションを開始
        this.startMouthAnimation();
        
        const type = () => {
            if (i < text.length) {
                element.textContent += text.charAt(i++);
                this.output.scrollTop = this.output.scrollHeight;
                
                // スペース以外の文字に対してサウンドを再生
                if (text.charAt(i-1) !== ' ') {
                    this.soundManager.playTypeSound();
                }
                
                setTimeout(type, this.settings.typewriterDelay);
            } else {
                // 完了したら口のアニメーションを停止
                this.stopMouthAnimation();
                resolve();
            }
        };
        
        type();
    });
}
```

### 仕組み

1.  **Promiseベース:** この関数は、タイプライター効果が完了したときに解決される `Promise` を返します。これにより、非同期の制御フローが可能になります。
2.  **一文字ずつ:** `type` 関数は `setTimeout` を使って再帰的に呼び出され、一度に一文字ずつ `element` に追加します。文字と文字の間の遅延は `this.settings.typewriterDelay` によって決まります。
3.  **口のアニメーション:** タイピングが始まる前に `startMouthAnimation()` が呼び出されます。この関数は、アバターの口の画像を繰り返し切り替えて、話しているように見せかけます。タイピングが終わると、`stopMouthAnimation()` が呼び出され、アバターはアイドル状態に戻ります。
4.  **サウンドエフェクト:** スペースではない各文字に対して、タイピング音を再生するために `soundManager.playTypeSound()` メソッドが呼び出されます。
5.  **スクロール:** 各文字が追加された後、`output` 要素が一番下までスクロールされ、最新のテキストが表示されるようになります。