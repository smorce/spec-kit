# リップシンクのドキュメント

このドキュメントでは、Webアプリケーションにおけるリップシンク機能の実装について概説します。

## 概要

リップシンク効果は、「アイドル」状態と「トーキング」状態の2つのアバター画像を高速で切り替えることによって実現されます。これにより、テキストが表示される際にアバターが話しているかのような錯覚を生み出します。プロセス全体はクライアント側のJavaScriptで管理され、設定値はバックエンドから提供されます。

## バックエンド

Flaskで構築されたバックエンドは、メインのHTMLページを提供し、必要な設定をフロントエンドに渡します。

### `app.py`

-   メインのアプリケーションファイルで、`index.html` テンプレートのレンダリングを担当します。
-   アバターやリップシンクに関連するものを含む、さまざまな設定が含まれた設定辞書をテンプレートに渡します。

### `settings.py`

-   このファイルは、`.env` ファイルから読み込まれるアプリケーションのすべての設定を定義します。
-   リップシンクのための主要な設定は以下の通りです：
    -   `AVATAR_IMAGE_IDLE`: アイドル状態のアバター画像のファイル名。
    -   `AVATAR_IMAGE_TALK`: トーキング状態のアバター画像のファイル名。
    -   `MOUTH_ANIMATION_INTERVAL_MS`: アニメーションを作成するためにアバター画像を切り替える間隔（ミリ秒）。

## フロントエンド

フロントエンドは、ユーザーインターフェースの処理、ユーザー入力の処理、およびリップシンクアニメーションの管理を担当します。

### `templates/index.html`

-   アプリケーションのメインHTMLファイルです。
-   バックエンドから設定を受け取り、`appConfig` というJavaScriptオブジェクトに保存します。
-   このオブジェクトにより、クライアント側のJavaScriptで設定が利用可能になります。

### `js/app.js`

-   クライアント側JavaScriptのメインエントリーポイントです。
-   リップシンクアニメーションを担当する `AnimationManager` を初期化します。

### `js/animation.js`

-   このファイルには、リップシンク効果のコアロジックが含まれています。
-   `AnimationManager` クラスには2つの主要なメソッドがあります：
    -   `startMouthAnimation()`: このメソッドは、AIが「話し」始めるときに呼び出されます。`setInterval` を使用して、`MOUTH_ANIMATION_INTERVAL_MS` で指定された間隔で `AVATAR_IMAGE_IDLE` と `AVATAR_IMAGE_TALK` の画像を切り替えます。
    -   `stopMouthAnimation()`: このメソッドは、AIが「話し」終えたときに呼び出されます。`startMouthAnimation()` によって設定されたインターバルをクリアし、アバター画像をアイドル状態にリセットします。
-   `typeWriter` メソッドは、タイプライター効果が始まるときに `startMouthAnimation` を呼び出し、終わるときに `stopMouthAnimation` を呼び出します。